var details,svg;const marginValue=10,textMargin=3;function init(t){details=document.getElementById("details").firstChild,svg=document.getElementsByTagName("svg")[0];var e=getAllStackUnits();if(e){const t=e.length;for(var i=0;i<t;i++)update_text(e[i])}}function s(t){details.nodeValue="Current: "+t}function c(){details.nodeValue=" "}function find_child(t,e,i){for(var a=t.childNodes,n=0;n<a.length;n++)if(a[n].tagName===e)return null!=i?a[n].attributes[i].value:a[n]}function orig_save(t,e,i){t.attributes["_orig_"+e]||t.attributes[e]&&(null==i&&(i=t.attributes[e].value),t.setAttribute("_orig_"+e,i))}function orig_load(t,e){t.attributes["_orig_"+e]&&(t.attributes[e].value=t.attributes["_orig_"+e].value)}function update_text(t){const e=find_child(t,"rect"),i=find_child(t,"text");if(null==i)return;const a=parseFloat(e.attributes.width.value)-textMargin,n=find_child(t,"title").textContent.replace(/\([^(]*\)/,"");if(i.attributes.x.value=parseFloat(e.attributes.x.value)+textMargin,a<14.16)i.textContent="";else if(i.textContent=n,!(/^ *$/.test(n)||i.getSubStringLength(0,n.length)<a)){for(var o=n.length-2;o>0;o--)if(i.getSubStringLength(0,o+2)<=a)return void(i.textContent=n.substring(0,o)+"..");i.textContent=""}}function zoom_reset(t){if(t.attributes&&(orig_load(t,"x"),orig_load(t,"width")),t.childNodes)for(var e=0,i=t.childNodes;e<i.length;e++)zoom_reset(i[e])}function zoom_child(t,e,i){if(t.attributes&&(t.attributes.x&&(orig_save(t,"x"),t.attributes.x.value=(parseFloat(t.attributes.x.value)-e-marginValue)*i+marginValue,"text"===t.tagName&&(t.attributes.x.value=find_child(t.parentNode,"rect","x")+textMargin)),t.attributes.width&&(orig_save(t,"width"),t.attributes.width.value=parseFloat(t.attributes.width.value)*i)),t.childNodes)for(var a=0,n=t.childNodes;a<n.length;a++)zoom_child(n[a],e-marginValue,i)}function zoom_parent(t){if(t.attributes&&(t.attributes.x&&(orig_save(t,"x"),t.attributes.x.value=marginValue),t.attributes.width&&(orig_save(t,"width"),t.attributes.width.value=parseInt(svg.width.baseVal.value)-2*marginValue)),t.childNodes)for(var e=0,i=t.childNodes;e<i.length;e++)zoom_parent(i[e])}function zoom(t){const e=find_child(t,"rect").attributes,i=parseFloat(e.width.value),a=parseFloat(e.x.value),n=parseFloat(a+i),o=parseFloat(e.y.value),l=(svg.width.baseVal.value-2*marginValue)/i;document.getElementById("unzoom").style.opacity="1.0";const r=getAllStackUnits(),s=r.length;for(var u=0;u<s;u++){const t=r[u],e=find_child(t,"rect").attributes,i=parseFloat(e.x.value),s=i+parseFloat(e.width.value);parseFloat(e.y.value)>o?i<=a&&s+1e-4>=n?(t.style.opacity="0.5",zoom_parent(t),t.onclick=function(t){resetZoom(),zoom(this)},update_text(t)):t.style.display="none":i<a||i+1e-4>=n?t.style.display="none":(zoom_child(t,a,l),t.onclick=function(t){zoom(this)},update_text(t))}}function getAllStackUnits(){return document.getElementsByClassName("unit_g")}function resetZoom(){document.getElementById("unzoom").style.opacity="0.0";const t=getAllStackUnits(),e=t.length;for(i=0;i<e;i++)t[i].style.display="block",t[i].style.opacity="1",zoom_reset(t[i]),update_text(t[i])}